<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Compute Graph Viewer</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<header class="toolbar">
  <div class="toolbar-l">
    <div class="toolbar-logo">
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
        <rect x="1" y="1" width="7" height="7" rx="1.5" fill="var(--op-accent)"/>
        <rect x="10" y="1" width="7" height="7" rx="1.5" fill="var(--tensor-accent)"/>
        <rect x="1" y="10" width="7" height="7" rx="1.5" fill="var(--incast-accent)"/>
        <rect x="10" y="10" width="7" height="7" rx="1.5" fill="var(--outcast-accent)"/>
      </svg>
      <span>Compute Graph</span>
    </div>
    <button class="btn" id="loadBtn">
      <svg width="13" height="13" viewBox="0 0 13 13" fill="none">
        <path d="M6.5 1v7M3 5.5l3.5 3 3.5-3M1.5 11h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Load JSON
    </button>
    <input type="file" id="fileInput" accept=".json">
    <div class="toolbar-sep"></div>
    <span class="graph-title" id="graphTitle"></span>
    <div class="graph-stats" id="graphStats"></div>
  </div>
  <div class="toolbar-r">
    <div class="legend">
      <span class="legend-item"><span class="legend-dot" style="background:var(--incast-accent)"></span>Incast</span>
      <span class="legend-item"><span class="legend-dot" style="background:var(--op-accent)"></span>Op</span>
      <span class="legend-item"><span class="legend-dot" style="background:var(--tensor-accent)"></span>Tensor</span>
      <span class="legend-item"><span class="legend-dot" style="background:var(--outcast-accent)"></span>Outcast</span>
    </div>
  </div>
</header>

<div class="viewport" id="viewport">
  <div class="graph-root" id="graphRoot">
    <svg class="edges-svg" id="edgesSvg" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <marker id="arrow-default" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
          <path d="M0,0 L0,6 L6,3 z" fill="rgba(255,255,255,0.15)"/>
        </marker>
        <marker id="arrow-incast" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
          <path d="M0,0 L0,6 L6,3 z" fill="var(--incast-accent)"/>
        </marker>
        <marker id="arrow-op" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
          <path d="M0,0 L0,6 L6,3 z" fill="var(--op-accent)"/>
        </marker>
        <marker id="arrow-outcast" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
          <path d="M0,0 L0,6 L6,3 z" fill="var(--outcast-accent)"/>
        </marker>
      </defs>
    </svg>
    <div class="nodes-layer" id="nodesLayer"></div>
  </div>

  <!-- Empty state -->
  <div class="empty-state" id="emptyState">
    <div class="empty-card">
      <div class="empty-icon-wrap">
        <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
          <rect x="4" y="20" width="18" height="14" rx="4" fill="var(--incast-accent)" fill-opacity="0.9"/>
          <rect x="23" y="8"  width="18" height="14" rx="4" fill="var(--op-accent)"     fill-opacity="0.9"/>
          <rect x="23" y="32" width="18" height="14" rx="4" fill="var(--tensor-accent)" fill-opacity="0.9"/>
          <rect x="42" y="20" width="18" height="14" rx="4" fill="var(--outcast-accent)" fill-opacity="0.9"/>
          <path d="M22 27h1M41 27h1M32 22v-1M32 32v1" stroke="rgba(255,255,255,0.5)" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </div>
      <h2 class="empty-title">Compute Graph Viewer</h2>
      <p class="empty-sub">Visualize Ascend NPU computation graphs</p>
      <div class="empty-actions">
        <button class="btn-md-primary" id="emptyLoadBtn">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M8 2v8M4.5 6.5L8 10l3.5-3.5M2 13h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Open JSON File
        </button>
        <div class="recent-row" id="recentRow">
          <span class="recent-label">Recent</span>
          <button class="recent-chip" id="recentChip">
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
              <circle cx="6" cy="6" r="5" stroke="currentColor" stroke-width="1.2"/>
              <path d="M6 3.5V6l1.5 1.5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
            <span id="recentName">—</span>
          </button>
        </div>
      </div>
      <div class="sample-row">
        <span class="recent-label">Samples</span>
        <button class="recent-chip sample-chip" data-sample="deepseek_out_pass/After_000_RemoveRedundantReshape_TENSOR_LOOP_RESHAPE_Unroll1_PATH0_4.json" data-label="LOOP_RESHAPE · PATH0">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><rect x="1" y="1" width="4" height="4" rx="1" fill="currentColor" fill-opacity="0.6"/><rect x="7" y="1" width="4" height="4" rx="1" fill="currentColor" fill-opacity="0.6"/><rect x="1" y="7" width="4" height="4" rx="1" fill="currentColor" fill-opacity="0.6"/><rect x="7" y="7" width="4" height="4" rx="1" fill="currentColor" fill-opacity="0.6"/></svg>
          LOOP_RESHAPE · PATH0
        </button>
        <button class="recent-chip sample-chip" data-sample="deepseek_out_pass/After_000_RemoveRedundantReshape_TENSOR_IndexerPrologQuantQuantLoop_Unroll1_PATH0_6.json" data-label="QuantLoop · PATH0">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><rect x="1" y="1" width="4" height="4" rx="1" fill="currentColor" fill-opacity="0.6"/><rect x="7" y="1" width="4" height="4" rx="1" fill="currentColor" fill-opacity="0.6"/><rect x="1" y="7" width="4" height="4" rx="1" fill="currentColor" fill-opacity="0.6"/><rect x="7" y="7" width="4" height="4" rx="1" fill="currentColor" fill-opacity="0.6"/></svg>
          QuantLoop · PATH0
        </button>
      </div>
      <p class="empty-hint">or drag &amp; drop a .json file anywhere</p>
    </div>
  </div>

  <!-- Minimap with zoom controls -->
  <div class="minimap" id="minimap">
    <canvas id="minimapCanvas" width="240" height="140"></canvas>
    <div class="minimap-viewport" id="minimapViewport"></div>
    <div class="minimap-controls">
      <button class="mm-btn" id="zoomOutBtn" title="Zoom Out">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M3 7h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      </button>
      <span class="zoom-label" id="zoomLabel">100%</span>
      <button class="mm-btn" id="zoomInBtn" title="Zoom In">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M7 3v8M3 7h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      </button>
      <div class="mm-sep"></div>
      <button class="mm-btn mm-fit" id="fitBtn" title="Fit View">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"><path d="M1 5V2h3M10 2h3v3M13 9v3h-3M4 13H1v-3" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
    </div>
  </div>
</div>

<aside class="detail-panel" id="detailPanel">
  <div class="detail-header">
    <div class="detail-type-badge" id="detailBadge"></div>
    <span class="detail-name" id="detailName"></span>
    <button class="btn btn-icon detail-close" id="detailClose">
      <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
        <path d="M1 1l10 10M11 1L1 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
    </button>
  </div>
  <div class="detail-body" id="detailBody"></div>
</aside>

<script src="js/parser.js"></script>
<script src="js/layout.js"></script>
<script src="js/renderer.js"></script>
<script src="js/app.js"></script>
</body>
</html>
